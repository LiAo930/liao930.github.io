(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{230:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"跨域方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域方案"}},[t._v("#")]),t._v(" 跨域方案")]),t._v(" "),a("h4",{attrs:{id:"_1-cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-cors"}},[t._v("#")]),t._v(" 1.CORS")]),t._v(" "),a("p",[t._v("​\t1.全称“跨域资源共享”，是一种克服"),a("strong",[t._v("同源")]),t._v("限制的访问策略，可以让用户的XMLHttpRequest请求发送到跨源服务器。")]),t._v(" "),a("p",[t._v("​\t2.CORS需要浏览器和服务器同时支持，浏览器的版本不能低于IE10.。由于通信过程都是由浏览器自动完成，不需要用户参与，"),a("strong",[t._v("当出现Ajax跨域访问时，会自动添加一些头部信息，因此实现CORS的关键是服务器端。")])]),t._v(" "),a("p",[t._v("​\t3.根据是否满足两个条件（1.请求方法是"),a("strong",[t._v("HEAD、GET、POST")]),t._v("其中之一；2.HTTP头部信息不超出"),a("strong",[t._v("Accept、Accept-Language、Content-Language、Last-Event-ID、Conte-Type（值必须为application/x-www-form-urlencoded"),a("code",[t._v("、")]),t._v("multipart/form-data"),a("code",[t._v("、")]),t._v("text/plain中的一个）这几个字段）"),a("strong",[t._v("分为")]),t._v("简单请求")]),t._v("和"),a("strong",[t._v("非简单请求")]),t._v("，两种请求的应对处理不同。")]),t._v(" "),a("p",[t._v("​\t"),a("strong",[t._v("针对简单请求")]),t._v("，浏览器会自动在请求头部中添加"),a("strong",[t._v("Origin")]),t._v("字段，指明请求的源。")]),t._v(" "),a("p",[t._v("​\t（1）如果请求源"),a("strong",[t._v("不在服务端许可范围")]),t._v("内，则响应头中不会有"),a("strong",[t._v("Access-Control-Allow-Origin")]),t._v("字段，从而被onerror回调函数捕获。"),a("strong",[t._v("注意，这种错误无法通过状态码识别，因为HTTP回应的状态码可能是200；")])]),t._v(" "),a("p",[t._v("​\t（2）如果请求源"),a("strong",[t._v("在服务端许可范围内")]),t._v("，则响应头中会有"),a("strong",[t._v("Access-Control-Allow-Origin（必备字段，值为请求时Origin的字段，或*，代表接受任意域名的请求）、Access-Control-Allow-Credentials（可选字段，布尔值，表示是否允许发送Cookie）、Access-Control-Expose-Headers（可选字段，指定想要返回的字段的值）、Content-Type")]),t._v("这几个字段；")]),t._v(" "),a("p",[t._v("​\t（3）withCredentials")]),t._v(" "),a("p",[t._v("​\t\t\tCORS默认不发送Cookie和HTTP认证信息。如果需要，则必须在服务端设置"),a("strong",[t._v("Access-Control-Allow-Credentials")]),t._v("字段为"),a("strong",[t._v("true")]),t._v("，开发者也必须把"),a("strong",[t._v("XMLHttpRequest")]),t._v("的"),a("strong",[t._v("withCredentials")]),t._v("属性设置为"),a("strong",[t._v("true")]),t._v("，两者缺一不可。")]),t._v(" "),a("p",[t._v("​\t\t\t如果要传递Cookie的话则Access-Control-Allow-Origin必须指定为"),a("strong",[t._v("与请求网页一致的域名")]),t._v("。此时的Cookie依然遵循同源策略，只有用"),a("strong",[t._v("服务器域名")]),t._v("上传，Cookie才会传递。")]),t._v(" "),a("p",[t._v("​\t"),a("strong",[t._v("针对非简单请求")]),t._v("（比如请求方法是"),a("strong",[t._v("PUT、DELETE，或Content-type的类型是application/json")]),t._v("的请求），会在正是通信之前来一次由浏览器发出的HTTP查询请求，称为"),a("strong",[t._v("预检请求")]),t._v("。")]),t._v(" "),a("p",[t._v("​\t预检请求中Origin为必要字段，表示请求页面源，同时也包括"),a("strong",[t._v("Access-Control-Request-Method、Access-Control-Request-Headers")]),t._v("两个特殊字段，分别代表本次请求使用的HTTP方法，和额外发送的头信息字段。服务器端检查后，如无问题则进行响应，"),a("strong",[t._v("Access-Control-Allow-Methods，Access-Control-Allow-Headers，Access-Control-Allow-Credentials，Access-Control-Max-Age")]),t._v("四个字段最重要，分别代表"),a("strong",[t._v("服务器端支持的方法，支持的返回字段，是否支持返回Cookie，有效期")]),t._v("。")]),t._v(" "),a("p",[t._v("​\t而当预检请求通过，之后的请求就和简单请求一样添加Origin字段和Access-Control-Allow-Origin字段。")]),t._v(" "),a("p",[t._v("​")]),t._v(" "),a("h4",{attrs:{id:"_2-jsonp跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-jsonp跨域"}},[t._v("#")]),t._v(" 2.JSONP跨域")]),t._v(" "),a("p",[t._v("​\tscript标签引入外部资源时不存在跨域的问题，因此可通过动态创建script标签，利用src属性进行跨域。例：")]),t._v(" "),a("p",[t._v("jsonp.html：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<!DOCTYPE html>\n<html lang="en">\n<head>\n\t<meta charset="UTF-8">\n\t<title>Document</title>\n\t<script>\n\t\tfunction handle(data) {\n\t\t\tconsole.log(data);\n\t\t}\n\t<\/script>\n</head>\n<body>\n\t<script type="text/javascript" src="http://localhost:3000/jsonp?callback=handle"><\/script>\n</body>\n</html>\n')])])]),a("p",[t._v("服务端：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("app.get('/jsonp',(req,res) => {\n\tlet fun = req.query.callback;\n\tres.send(fun+ '({\"name\":\"lalala\"})');\n})\n")])])]),a("p",[a("strong",[t._v("缺点")]),t._v("：")]),t._v(" "),a("p",[t._v("​\t1.只支持get请求；")]),t._v(" "),a("p",[t._v("​\t2.代码从外域引入，存在安全性问题；")]),t._v(" "),a("p",[t._v("​\t3.本身存在请求失败的问题，虽然提供了"),a("strong",[t._v("onerror")]),t._v("解决问题，仍存在兼容性问题")]),t._v(" "),a("h4",{attrs:{id:"_3-document-domain跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-document-domain跨域"}},[t._v("#")]),t._v(" 3.document.domain跨域")]),t._v(" "),a("p",[t._v("​\t对于主域名相同，子域名不同的情况，可以通过在"),a("strong",[t._v("所有页面中")]),t._v("设置相同的document.doamin来实现跨域。不过设置的值只能是更高级的父级域，不能是子域和外域。")]),t._v(" "),a("h4",{attrs:{id:"_4-window-name跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-window-name跨域"}},[t._v("#")]),t._v(" 4.window.name跨域")]),t._v(" "),a("p",[t._v("​\t对于一个窗口下的所有页面，"),a("strong",[t._v("window.name")]),t._v("是相同且共用的一个值，所以我们也可以借助window.name来实现不同域页面间的数据交互。")]),t._v(" "),a("h5",{attrs:{id:"对于同源页面，直接通过window-name访问即可；对于不同的域，可以借助一个ifream作为代理，例如下："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对于同源页面，直接通过window-name访问即可；对于不同的域，可以借助一个ifream作为代理，例如下："}},[t._v("#")]),t._v(" 对于同源页面，直接通过window.name访问即可；对于不同的域，可以借助一个ifream作为代理，例如下：")]),t._v(" "),a("h4",{attrs:{id:"_5-新方法postmessage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-新方法postmessage"}},[t._v("#")]),t._v(" 5.新方法postMessage")]),t._v(" "),a("p",[t._v("​\t这应该是未来最通用的方法，也是html5新引入的特性，可以向其他window发送消息，且大多数浏览器（IE8+，火狐，chrome，Opera等均以支持）；")]),t._v(" "),a("p",[t._v("Message事件代表信息的传递，通常与postMessage方法配合使用")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//h5为了解决跨域问题而提出的新api，data是要传输的数据，domian代表目标域")]),t._v("\n")])])]),a("p",[t._v("通常当一端使用postMessage方法传递数据时，另一端都会监听message事件，并绑定触发函数，如：")]),t._v(" "),a("h5",{attrs:{id:"test1-html"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test1-html"}},[t._v("#")]),t._v(" test1.html")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"button"')]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"click me and send message"')]),t._v(" onclick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sendMessage()"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("iframe id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iframe1"')]),t._v(" \n\t\t\tsrc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./test2.html"')]),t._v(" \n\t\t\tstyle"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"width:300px;height:400px;"')]),t._v(" \n\t\t\tframeborder"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("iframe"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" frm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iframe1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oI "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsByTagName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'input'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          \tfrm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h5",{attrs:{id:"test2-html"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test2-html"}},[t._v("#")]),t._v(" test2.html")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("i am test2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("OnMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\twindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("OnMessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);