<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>跨域方案 | 前端学习日志</title>
    <meta name="description" content="my study log">
    
    
    <link rel="preload" href="/assets/css/0.styles.cf9c9213.css" as="style"><link rel="preload" href="/assets/js/app.9b313d47.js" as="script"><link rel="preload" href="/assets/js/2.4bf212e8.js" as="script"><link rel="preload" href="/assets/js/30.07790abe.js" as="script"><link rel="prefetch" href="/assets/js/10.f2d103fd.js"><link rel="prefetch" href="/assets/js/11.33575be4.js"><link rel="prefetch" href="/assets/js/12.63b2fce1.js"><link rel="prefetch" href="/assets/js/13.692ae22b.js"><link rel="prefetch" href="/assets/js/14.8d953be8.js"><link rel="prefetch" href="/assets/js/15.55a6242d.js"><link rel="prefetch" href="/assets/js/16.d58f7781.js"><link rel="prefetch" href="/assets/js/17.17fb6526.js"><link rel="prefetch" href="/assets/js/18.b97b86dc.js"><link rel="prefetch" href="/assets/js/19.cc381d1a.js"><link rel="prefetch" href="/assets/js/20.164ed89e.js"><link rel="prefetch" href="/assets/js/21.ad42f5b9.js"><link rel="prefetch" href="/assets/js/22.206e414d.js"><link rel="prefetch" href="/assets/js/23.45644994.js"><link rel="prefetch" href="/assets/js/24.c3a4f621.js"><link rel="prefetch" href="/assets/js/25.7d283e6f.js"><link rel="prefetch" href="/assets/js/26.4b4b924d.js"><link rel="prefetch" href="/assets/js/27.2ca66b1f.js"><link rel="prefetch" href="/assets/js/28.754382f8.js"><link rel="prefetch" href="/assets/js/29.1a8e6bd3.js"><link rel="prefetch" href="/assets/js/3.68d6810e.js"><link rel="prefetch" href="/assets/js/31.438b6500.js"><link rel="prefetch" href="/assets/js/32.da59c1b4.js"><link rel="prefetch" href="/assets/js/33.31336004.js"><link rel="prefetch" href="/assets/js/34.8a0050e3.js"><link rel="prefetch" href="/assets/js/35.210902da.js"><link rel="prefetch" href="/assets/js/36.3cd75e09.js"><link rel="prefetch" href="/assets/js/37.10a14803.js"><link rel="prefetch" href="/assets/js/38.493eefde.js"><link rel="prefetch" href="/assets/js/39.f25d1902.js"><link rel="prefetch" href="/assets/js/4.048ff8f3.js"><link rel="prefetch" href="/assets/js/40.ce91389a.js"><link rel="prefetch" href="/assets/js/41.3b084704.js"><link rel="prefetch" href="/assets/js/42.74fd7b36.js"><link rel="prefetch" href="/assets/js/43.5151b982.js"><link rel="prefetch" href="/assets/js/44.c7b0a7f8.js"><link rel="prefetch" href="/assets/js/45.cc19d4ac.js"><link rel="prefetch" href="/assets/js/46.16d696d5.js"><link rel="prefetch" href="/assets/js/47.28572ab1.js"><link rel="prefetch" href="/assets/js/48.bf30d900.js"><link rel="prefetch" href="/assets/js/49.4e40bbea.js"><link rel="prefetch" href="/assets/js/5.8f069aa3.js"><link rel="prefetch" href="/assets/js/50.92df4fe8.js"><link rel="prefetch" href="/assets/js/51.983bf137.js"><link rel="prefetch" href="/assets/js/52.8e9176f4.js"><link rel="prefetch" href="/assets/js/53.3c147736.js"><link rel="prefetch" href="/assets/js/54.9939b16d.js"><link rel="prefetch" href="/assets/js/55.4b2b7569.js"><link rel="prefetch" href="/assets/js/56.1e051ca2.js"><link rel="prefetch" href="/assets/js/57.ee0151c9.js"><link rel="prefetch" href="/assets/js/58.b8b0f7a5.js"><link rel="prefetch" href="/assets/js/59.73e9672e.js"><link rel="prefetch" href="/assets/js/6.2e4b1887.js"><link rel="prefetch" href="/assets/js/60.6cb7f6c0.js"><link rel="prefetch" href="/assets/js/61.04c67ffc.js"><link rel="prefetch" href="/assets/js/62.513b6c7e.js"><link rel="prefetch" href="/assets/js/63.d3c0f9fc.js"><link rel="prefetch" href="/assets/js/64.80740fd6.js"><link rel="prefetch" href="/assets/js/65.1f286298.js"><link rel="prefetch" href="/assets/js/66.956bc111.js"><link rel="prefetch" href="/assets/js/67.68453c46.js"><link rel="prefetch" href="/assets/js/68.9000d41e.js"><link rel="prefetch" href="/assets/js/69.78db0538.js"><link rel="prefetch" href="/assets/js/7.70b7e5f0.js"><link rel="prefetch" href="/assets/js/70.3fd0e7c9.js"><link rel="prefetch" href="/assets/js/71.61f3112e.js"><link rel="prefetch" href="/assets/js/72.30120d65.js"><link rel="prefetch" href="/assets/js/73.642a7a88.js"><link rel="prefetch" href="/assets/js/74.bec483ce.js"><link rel="prefetch" href="/assets/js/75.f146d868.js"><link rel="prefetch" href="/assets/js/76.99529a90.js"><link rel="prefetch" href="/assets/js/8.5d8d45e8.js"><link rel="prefetch" href="/assets/js/9.453972e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cf9c9213.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端学习日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/Vue/动态组件/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/webpack/webpack基础配置.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/MongoDB/MongoDB初识.html" class="nav-link">MongoDB</a></div><div class="nav-item"><a href="/Nodejs/Nginx.html" class="nav-link">Nodejs</a></div><div class="nav-item"><a href="/Openlayer/OpenLayer.html" class="nav-link">Openlayer</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/Vue/动态组件/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/webpack/webpack基础配置.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/MongoDB/MongoDB初识.html" class="nav-link">MongoDB</a></div><div class="nav-item"><a href="/Nodejs/Nginx.html" class="nav-link">Nodejs</a></div><div class="nav-item"><a href="/Openlayer/OpenLayer.html" class="nav-link">Openlayer</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>作用域和闭包</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Ajax跨域</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript/异步操作/跨域问题.html" class="active sidebar-link">跨域问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/异步操作/跨域问题.html#跨域方案" class="sidebar-link">跨域方案</a></li></ul></li><li><a href="/JavaScript/异步操作/异步问题.html" class="sidebar-link">异步问题</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>每日习题</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/JavaScript/new操作符和原型链.html" class="sidebar-link">new操作符和原型链</a></li><li><a href="/JavaScript/对象创建和继承.html" class="sidebar-link">对象创建和继承</a></li><li><a href="/JavaScript/URLSearchParams.html" class="sidebar-link">查询条件封装对象URLSearchParams</a></li><li><a href="/JavaScript/BOM相关.html" class="sidebar-link">BOM相关</a></li><li><a href="/JavaScript/DOM.html" class="sidebar-link">DOM</a></li><li><a href="/JavaScript/ES6.html" class="sidebar-link">ES6</a></li><li><a href="/JavaScript/函数中按值传递的理解.html" class="sidebar-link">函数中按值传递的理解</a></li><li><a href="/JavaScript/javaScript中的Event Loop机制.html" class="sidebar-link">javaScript中的Event Loop机制</a></li><li><a href="/JavaScript/MockJs.html" class="sidebar-link">MockJs</a></li><li><a href="/JavaScript/js使用技巧.html" class="sidebar-link">js使用技巧</a></li><li><a href="/JavaScript/拖拽API.html" class="sidebar-link">拖拽API</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="跨域方案"><a href="#跨域方案" class="header-anchor">#</a> 跨域方案</h2> <h4 id="_1-cors"><a href="#_1-cors" class="header-anchor">#</a> 1.CORS</h4> <p>​	1.全称“跨域资源共享”，是一种克服<strong>同源</strong>限制的访问策略，可以让用户的XMLHttpRequest请求发送到跨源服务器。</p> <p>​	2.CORS需要浏览器和服务器同时支持，浏览器的版本不能低于IE10.。由于通信过程都是由浏览器自动完成，不需要用户参与，<strong>当出现Ajax跨域访问时，会自动添加一些头部信息，因此实现CORS的关键是服务器端。</strong></p> <p>​	3.根据是否满足两个条件（1.请求方法是<strong>HEAD、GET、POST</strong>其中之一；2.HTTP头部信息不超出<strong>Accept、Accept-Language、Content-Language、Last-Event-ID、Conte-Type（值必须为application/x-www-form-urlencoded<code>、</code>multipart/form-data<code>、</code>text/plain中的一个）这几个字段）<strong>分为</strong>简单请求</strong>和<strong>非简单请求</strong>，两种请求的应对处理不同。</p> <p>​	<strong>针对简单请求</strong>，浏览器会自动在请求头部中添加<strong>Origin</strong>字段，指明请求的源。</p> <p>​	（1）如果请求源<strong>不在服务端许可范围</strong>内，则响应头中不会有<strong>Access-Control-Allow-Origin</strong>字段，从而被onerror回调函数捕获。<strong>注意，这种错误无法通过状态码识别，因为HTTP回应的状态码可能是200；</strong></p> <p>​	（2）如果请求源<strong>在服务端许可范围内</strong>，则响应头中会有<strong>Access-Control-Allow-Origin（必备字段，值为请求时Origin的字段，或*，代表接受任意域名的请求）、Access-Control-Allow-Credentials（可选字段，布尔值，表示是否允许发送Cookie）、Access-Control-Expose-Headers（可选字段，指定想要返回的字段的值）、Content-Type</strong>这几个字段；</p> <p>​	（3）withCredentials</p> <p>​			CORS默认不发送Cookie和HTTP认证信息。如果需要，则必须在服务端设置<strong>Access-Control-Allow-Credentials</strong>字段为<strong>true</strong>，开发者也必须把<strong>XMLHttpRequest</strong>的<strong>withCredentials</strong>属性设置为<strong>true</strong>，两者缺一不可。</p> <p>​			如果要传递Cookie的话则Access-Control-Allow-Origin必须指定为<strong>与请求网页一致的域名</strong>。此时的Cookie依然遵循同源策略，只有用<strong>服务器域名</strong>上传，Cookie才会传递。</p> <p>​	<strong>针对非简单请求</strong>（比如请求方法是<strong>PUT、DELETE，或Content-type的类型是application/json</strong>的请求），会在正是通信之前来一次由浏览器发出的HTTP查询请求，称为<strong>预检请求</strong>。</p> <p>​	预检请求中Origin为必要字段，表示请求页面源，同时也包括<strong>Access-Control-Request-Method、Access-Control-Request-Headers</strong>两个特殊字段，分别代表本次请求使用的HTTP方法，和额外发送的头信息字段。服务器端检查后，如无问题则进行响应，<strong>Access-Control-Allow-Methods，Access-Control-Allow-Headers，Access-Control-Allow-Credentials，Access-Control-Max-Age</strong>四个字段最重要，分别代表<strong>服务器端支持的方法，支持的返回字段，是否支持返回Cookie，有效期</strong>。</p> <p>​	而当预检请求通过，之后的请求就和简单请求一样添加Origin字段和Access-Control-Allow-Origin字段。</p> <p>​</p> <h4 id="_2-jsonp跨域"><a href="#_2-jsonp跨域" class="header-anchor">#</a> 2.JSONP跨域</h4> <p>​	script标签引入外部资源时不存在跨域的问题，因此可通过动态创建script标签，利用src属性进行跨域。例：</p> <p>jsonp.html：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
	&lt;meta charset=&quot;UTF-8&quot;&gt;
	&lt;title&gt;Document&lt;/title&gt;
	&lt;script&gt;
		function handle(data) {
			console.log(data);
		}
	&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;script type=&quot;text/javascript&quot; src=&quot;http://localhost:3000/jsonp?callback=handle&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>服务端：</p> <div class="language- extra-class"><pre class="language-text"><code>app.get('/jsonp',(req,res) =&gt; {
	let fun = req.query.callback;
	res.send(fun+ '({&quot;name&quot;:&quot;lalala&quot;})');
})
</code></pre></div><p><strong>缺点</strong>：</p> <p>​	1.只支持get请求；</p> <p>​	2.代码从外域引入，存在安全性问题；</p> <p>​	3.本身存在请求失败的问题，虽然提供了<strong>onerror</strong>解决问题，仍存在兼容性问题</p> <h4 id="_3-document-domain跨域"><a href="#_3-document-domain跨域" class="header-anchor">#</a> 3.document.domain跨域</h4> <p>​	对于主域名相同，子域名不同的情况，可以通过在<strong>所有页面中</strong>设置相同的document.doamin来实现跨域。不过设置的值只能是更高级的父级域，不能是子域和外域。</p> <h4 id="_4-window-name跨域"><a href="#_4-window-name跨域" class="header-anchor">#</a> 4.window.name跨域</h4> <p>​	对于一个窗口下的所有页面，<strong>window.name</strong>是相同且共用的一个值，所以我们也可以借助window.name来实现不同域页面间的数据交互。</p> <h5 id="对于同源页面，直接通过window-name访问即可；对于不同的域，可以借助一个ifream作为代理，例如下："><a href="#对于同源页面，直接通过window-name访问即可；对于不同的域，可以借助一个ifream作为代理，例如下：" class="header-anchor">#</a> 对于同源页面，直接通过window.name访问即可；对于不同的域，可以借助一个ifream作为代理，例如下：</h5> <h4 id="_5-新方法postmessage"><a href="#_5-新方法postmessage" class="header-anchor">#</a> 5.新方法postMessage</h4> <p>​	这应该是未来最通用的方法，也是html5新引入的特性，可以向其他window发送消息，且大多数浏览器（IE8+，火狐，chrome，Opera等均以支持）；</p> <p>Message事件代表信息的传递，通常与postMessage方法配合使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">postMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>domain<span class="token punctuation">)</span> 
<span class="token comment">//h5为了解决跨域问题而提出的新api，data是要传输的数据，domian代表目标域</span>
</code></pre></div><p>通常当一端使用postMessage方法传递数据时，另一端都会监听message事件，并绑定触发函数，如：</p> <h5 id="test1-html"><a href="#test1-html" class="header-anchor">#</a> test1.html</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;click me and send message&quot;</span> onclick<span class="token operator">=</span><span class="token string">&quot;sendMessage()&quot;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>iframe id<span class="token operator">=</span><span class="token string">&quot;iframe1&quot;</span> 
			src<span class="token operator">=</span><span class="token string">&quot;./test2.html&quot;</span> 
			style<span class="token operator">=</span><span class="token string">&quot;width:300px;height:400px;&quot;</span> 
			frameborder<span class="token operator">=</span><span class="token string">&quot;0&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>iframe<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
		<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">var</span> frm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;iframe1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> oI <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          	frm<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>oI<span class="token punctuation">.</span>value<span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h5 id="test2-html"><a href="#test2-html" class="header-anchor">#</a> test2.html</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>i am test2<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
		<span class="token keyword">function</span> <span class="token function">OnMessage</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span>OnMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>	
		<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/JavaScript/作用域和闭包/闭包初识.html" class="prev">闭包初识</a></span> <span class="next"><a href="/JavaScript/异步操作/异步问题.html">异步问题</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9b313d47.js" defer></script><script src="/assets/js/2.4bf212e8.js" defer></script><script src="/assets/js/30.07790abe.js" defer></script>
  </body>
</html>
